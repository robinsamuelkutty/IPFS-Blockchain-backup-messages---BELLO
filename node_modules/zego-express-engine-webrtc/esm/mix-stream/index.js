!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("long"),require("protobufjs/minimal"));else if("function"==typeof define&&define.amd)define(["long","protobufjs/minimal"],t);else{var r="object"==typeof exports?t(require("long"),require("protobufjs/minimal")):t(e.long,e["protobufjs/minimal"]);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}("undefined"!=typeof self?self:this,(function(e,t){return function(){"use strict";var r={3091:function(e,t,r){var n;!function(e){e[e.PortraitSegmentation=0]="PortraitSegmentation"}(n||(n={}))},2593:function(e,t,r){var n,o,i;!function(e){e[e.Song=0]="Song",e[e.Accompaniment=1]="Accompaniment",e[e.AccompanimentClip=2]="AccompanimentClip",e[e.AccompanimentSegment=3]="AccompanimentSegment"}(n||(n={})),function(e){e[e.Count=0]="Count",e[e.User=1]="User",e[e.Room=2]="Room",e[e.Master=3]="Master"}(o||(o={})),function(e){e[e.VendorDefault=0]="VendorDefault",e[e.Vendor1=1]="Vendor1",e[e.Vendor2=2]="Vendor2",e[e.Vendor3=4]="Vendor3"}(i||(i={}))},9022:function(e,t,r){r.d(t,{Xk:function(){return d},zN:function(){return c}});var n,o,i,s,u,a,d,m,c,f,l,_,v;r(8899),r(2593),r(3091),r(166);!function(e){e[e.Off=0]="Off",e[e.On=1]="On"}(n||(n={})),function(e){e[e.PortraitSegmentation=0]="PortraitSegmentation"}(o||(o={})),function(e){e[e.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",e[e.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",e[e.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}(i||(i={})),function(e){e[e.AspectFill=0]="AspectFill",e[e.AspectFit=1]="AspectFit"}(s||(s={})),function(e){e[e.ZegoFontTypeSourceHanSans=0]="ZegoFontTypeSourceHanSans",e[e.ZegoFontTypeAlibabaSans=1]="ZegoFontTypeAlibabaSans",e[e.ZegoFontTypePangMenZhengDaoTitle=2]="ZegoFontTypePangMenZhengDaoTitle",e[e.ZegoFontTypeHappyZcool=3]="ZegoFontTypeHappyZcool"}(u||(u={})),function(e){e[e.ZegoDefined=0]="ZegoDefined",e[e.UserUnregister=1]="UserUnregister"}(a||(a={})),function(e){e[e.ZegoAudioCodecIDNormal=1]="ZegoAudioCodecIDNormal",e[e.ZegoAudioCodecIDNormal2=2]="ZegoAudioCodecIDNormal2",e[e.ZegoAudioCodecIDLow3=6]="ZegoAudioCodecIDLow3"}(d||(d={})),function(e){e[e.ZegoAudioMixModeRaw=0]="ZegoAudioMixModeRaw",e[e.ZegoAudioMixModeFocused=1]="ZegoAudioMixModeFocused"}(m||(m={})),function(e){e[e.ZegoEncodeProfileDefault=0]="ZegoEncodeProfileDefault",e[e.ZegoEncodeProfileBaseline=1]="ZegoEncodeProfileBaseline",e[e.ZegoEncodeProfileMain=2]="ZegoEncodeProfileMain",e[e.ZegoEncodeProfileHigh=3]="ZegoEncodeProfileHigh"}(c||(c={})),function(e){e[e.TrafficControlFocusOnLocalOnly=0]="TrafficControlFocusOnLocalOnly",e[e.TrafficControlFocusOnRemote=1]="TrafficControlFocusOnRemote"}(f||(f={})),function(e){e[e.NoVideo=0]="NoVideo"}(l||(l={})),function(e){e[e.Allow=0]="Allow",e[e.NotAllow=1]="NotAllow"}(_||(_={})),function(e){e[e.video=0]="video",e[e.audio=1]="audio",e[e.videoAndAudio=2]="videoAndAudio"}(v||(v={}))},2362:function(){!function(){function e(e){this.zegoStream=e}Object.defineProperty(e.prototype,"active",{get:function(){return this.zegoStream.active},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.zegoStream.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoCaptureStream",{get:function(){return this.zegoStream.originVideoStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioCaptureStream",{get:function(){return this.zegoStream.originAudioStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.zegoStream.stream},enumerable:!1,configurable:!0}),e.prototype.getAudioTracks=function(){return this.zegoStream.getAudioTracks()},e.prototype.getVideoTracks=function(){return this.zegoStream.getVideoTracks()},e.prototype.getTracks=function(){return this.zegoStream.getTracks()},Object.defineProperty(e.prototype,"videoDeviceId",{get:function(){return this.zegoStream.videoDeviceId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioDeviceId",{get:function(){return this.zegoStream.audioDeviceId},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){return this.zegoStream.on(e,t)},e.prototype.off=function(e,t){return this.zegoStream.off(e,t)},e.prototype.startCaptureMicrophone=function(e){return this.zegoStream.startCaptureMicrophone(e)},e.prototype.startCaptureCamera=function(e){return this.zegoStream.startCaptureCamera(e)},e.prototype.startCaptureCameraAndMicrophone=function(e,t){return this.zegoStream.startCaptureCameraAndMicrophone(e,t)},e.prototype.startCaptureCustomAudio=function(e){return this.zegoStream.startCaptureCustomAudio(e)},e.prototype.startCaptureCustomVideo=function(e){return this.zegoStream.startCaptureCustomVideo(e)},e.prototype.startCaptureCustomVideoAndAudio=function(e,t){return this.zegoStream.startCaptureCustomVideoAndAudio(e,t)},e.prototype.startCaptureScreen=function(e){return this.zegoStream.startCaptureScreen(e)},e.prototype.startCaptureScreenWithAudio=function(e,t){return this.zegoStream.startCaptureScreenWithAudio(e,t)},e.prototype.stopCaptureAudio=function(){return this.zegoStream.stopCaptureAudio()},e.prototype.stopCaptureVideo=function(){return this.zegoStream.stopCaptureVideo()},e.prototype.playAudio=function(e){this.zegoStream.playAudio(e)},e.prototype.playCaptureAudio=function(e){this.zegoStream.playCaptureAudio(e)},e.prototype.playVideo=function(e,t){this.zegoStream.playVideo(e,t)},e.prototype.playCaptureVideo=function(e,t){this.zegoStream.playCaptureVideo(e,t)},e.prototype.takeStreamSnapshot=function(e){return this.zegoStream.takeStreamSnapshot(e)},e.prototype.resumeVideo=function(){return this.zegoStream.resumeVideo()},e.prototype.resumeAudio=function(){return this.zegoStream.resumeAudio()},e.prototype.stopVideo=function(){this.zegoStream.stopVideo()},e.prototype.stopAudio=function(){this.zegoStream.stopAudio()},e.prototype.stopPlayCaptureVideo=function(){this.zegoStream.stopPlayCaptureVideo()},e.prototype.stopPlayCaptureAudio=function(){this.zegoStream.stopPlayCaptureAudio()},e.prototype.setVolume=function(e){return this.zegoStream.setVolume(e)},e.prototype.useAudioOutputDevice=function(e){return this.zegoStream.setAudioOutputDevice(e)}}()},8899:function(e,t,r){var n,o,i,s;!function(e){e[e.Off=0]="Off",e[e.TurningOn=1]="TurningOn",e[e.On=2]="On"}(n||(n={})),function(e){e[e.World=0]="World",e[e.Team=1]="Team",e[e.SecretTeam=2]="SecretTeam"}(o||(o={})),function(e){e[e.All=0]="All",e[e.World=1]="World",e[e.Team=2]="Team"}(i||(i={})),function(e){e[e.All=0]="All",e[e.World=1]="World",e[e.Team=2]="Team"}(s||(s={}))},166:function(e,t,r){var n,o,i,s;!function(e){e[e.NONE=0]="NONE",e[e.MEN_TO_CHILD=1]="MEN_TO_CHILD",e[e.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",e[e.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",e[e.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",e[e.FOREIGNER=5]="FOREIGNER",e[e.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",e[e.ANDROID=7]="ANDROID",e[e.ETHEREAL=8]="ETHEREAL",e[e.MALE_MAGNETIC=9]="MALE_MAGNETIC",e[e.FEMALE_FRESH=10]="FEMALE_FRESH",e[e.MAJOR_C=11]="MAJOR_C",e[e.MINOR_A=12]="MINOR_A",e[e.HARMONIC_MINOR=13]="HARMONIC_MINOR",e[e.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",e[e.RICHNESS=15]="RICHNESS",e[e.MUFFLED=16]="MUFFLED",e[e.ROUNDNESS=17]="ROUNDNESS",e[e.FALSETTO=18]="FALSETTO",e[e.FULLNESS=19]="FULLNESS",e[e.CLEAR=20]="CLEAR",e[e.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",e[e.LOUD_CLEAR=22]="LOUD_CLEAR"}(n||(n={})),function(e){e[e.None=0]="None",e[e.SoftRoom=1]="SoftRoom",e[e.LargeRoom=2]="LargeRoom",e[e.ConcertHall=3]="ConcertHall",e[e.Valley=4]="Valley",e[e.RecordingStudio=5]="RecordingStudio",e[e.Basement=6]="Basement",e[e.KTV=7]="KTV",e[e.Popular=8]="Popular",e[e.Rock=9]="Rock",e[e.VocalConcert=10]="VocalConcert",e[e.GramoPhone=11]="GramoPhone",e[e.EnhancedKTV=12]="EnhancedKTV"}(o||(o={})),function(e){e[e.None=0]="None",e[e.Local=1]="Local",e[e.Publish=2]="Publish",e[e.All=3]="All"}(i||(i={})),function(e){e[e.AI=0]="AI",e[e.AIBalanced=1]="AIBalanced",e[e.AIAggressive=2]="AIAggressive"}(s||(s={}))},4908:function(e,t,r){r.d(t,{oq:function(){return o}});r(8627),r(5095);var n="/sdk/init",o={event:n}},5095:function(e,t,r){r.d(t,{Gq:function(){return n},Tr:function(){return s},tK:function(){return o},yS:function(){return u},yp:function(){return i}});var n=function(e){return e},o=function(e){return e},i=function(e){return e},s=function(e){return e},u=function(e){return e}},8627:function(e,t,r){r.d(t,{$wo:function(){return j},Arx:function(){return Me},B3d:function(){return be},Be2:function(){return se},FB3:function(){return B},HCP:function(){return J},HO9:function(){return x},I4J:function(){return ye},I7C:function(){return oe},J79:function(){return a},JDv:function(){return ae},JSm:function(){return ue},L8E:function(){return G},LLz:function(){return T},MK1:function(){return _e},MrD:function(){return te},MrS:function(){return D},MuX:function(){return ke},NCg:function(){return Xe},OdW:function(){return Le},OrZ:function(){return A},Oy0:function(){return l},PA0:function(){return d},PTE:function(){return O},Q3v:function(){return de},Q4o:function(){return we},Q9p:function(){return f},Qo5:function(){return v},RBR:function(){return ce},RZs:function(){return Ne},RfS:function(){return Z},S4u:function(){return i},S5f:function(){return m},SB8:function(){return Re},SRE:function(){return W},SmZ:function(){return L},Srw:function(){return p},Tij:function(){return Se},V2t:function(){return S},VU9:function(){return U},WP4:function(){return ee},XHx:function(){return Ie},Xxx:function(){return M},ZEp:function(){return c},ZpF:function(){return y},Zws:function(){return xe},_68:function(){return P},_HD:function(){return _},aUw:function(){return E},aa2:function(){return $},ann:function(){return le},b1q:function(){return Ce},cMG:function(){return ze},ckD:function(){return Ue},ckg:function(){return Pe},clM:function(){return s},d49:function(){return u},dXc:function(){return Te},dg1:function(){return q},dqB:function(){return ve},ekj:function(){return Ee},f43:function(){return V},fzq:function(){return H},g9p:function(){return b},gHA:function(){return ge},gSF:function(){return h},hYx:function(){return qe},hje:function(){return he},iei:function(){return w},jZ$:function(){return X},jut:function(){return z},kOd:function(){return Y},kbF:function(){return Q},lgu:function(){return Oe},m6U:function(){return ne},mrK:function(){return re},pWJ:function(){return Ae},qvY:function(){return me},sJH:function(){return k},sVF:function(){return I},s_m:function(){return N},t85:function(){return F},ulL:function(){return g},wxm:function(){return pe},xU2:function(){return K},xbZ:function(){return fe},xfZ:function(){return R},yK:function(){return C},zML:function(){return De},zs3:function(){return ie}});var n=r(8866),o="the user cancels the stream request.",i={code:1000002,message:"not login room"},s={code:1000014,message:"stream ID is too long"},u={code:1000015,message:"streamID is empty"},a={code:1000016,message:"stream ID contains illegal characters"},d={code:1000017,message:n.Rl},m={code:1000018,message:n.qC},c={code:1100001,message:n.dO},f={code:1100002,message:"network timeout."},l={code:1100999,message:"unknown server error"},_={code:1101005,message:"signal hb fail"},v={code:1002011,message:"room ID is empty"},g={code:1002012,message:"room ID contains illegal characters"},p={code:1002013,message:"room ID is too long"},h={code:1102017,message:"dispatch error"},b={code:1102018,message:"token expired"},x={code:1102021,message:"biz channel error."},R={code:1102022,message:"dispatch request timeout"},E={code:1102024,message:"invalid channel"},I={code:1102026,msg:n.fT},M={code:1003025,message:"stream is forbided by media server"},O={code:1003050,message:"the extra info of the stream is null"},S={code:1003051,message:"the extra info of the stream is too long"},D={code:1003080,message:"browser does not support the codec"},T={code:1103001,message:n.dO},A={code:1103002,message:"browser do not support"},C={code:1103010,message:"screen fail"},N={code:1103011,message:"enumerate devices fail"},z={code:1103012,message:"use camera device fail"},k={code:1103019,message:"publish streams auth fail"},y={code:1103021,message:"session request fail"},L={code:1103022,message:"create offer error"},U={code:1103023,message:"setLocalDescription error"},q={code:1103024,message:"mediaDesc error"},w={code:1103025,message:"other side offer error"},P={code:1103026,message:"candidate error"},X={code:1103027,message:"server session closed"},$={code:1103028,message:"ice connection error"},j={code:1103030,message:"negotiation timeout"},F={code:1103042,message:"screen canceled"},G={code:1103043,message:"screen not support"},H={code:1103044,message:n.aw},V={code:1103099,message:"stream is not capturing"},Z={code:1103049,message:"repeated pull same stream"},J={code:1103050,message:"websocket disconnected"},W={code:1103051,message:"publisher retry timeout"},B={code:1103053,message:"https is required"},K={code:1103055,message:n.Wk},Q={code:1103056,message:"publish is publishing"},Y={code:1103058,message:"client ip changed"},ee={code:1103059,message:"ttl over time"},te={code:1103060,message:"session request timeout"},re={code:1103061,message:"get media fail"},ne={code:1103062,message:"update stream info fail"},oe={code:1103063,message:"publish target no response"},ie={code:1103064,message:"get device not allowed"},se={code:1103065,message:"device is not readable"},ue={code:1103066,message:"device does not meet constraints"},ae={code:1103067,message:"update sdp time out"},de={code:1103068,message:"update sdp fail"},me={code:1103073,message:"video effect is starting, please operate after video effect is started"},ce={code:1103078,message:"publish stream poor and net probe poor"},fe={code:1103089,message:o},le={code:1104001,message:"input parm error"},_e={code:1104021,message:"session request fail"},ve={code:1104022,message:"create offer error"},ge={code:1104023,message:"setLocalDescription error"},pe={code:1104024,message:"mediaDesc error"},he={code:1104025,message:"other side offer error"},be={code:1104026,message:"candidate error"},xe={code:1104028,message:"ice connection error"},Re={code:1104029,message:"websocket disconnected"},Ee={code:1104030,message:"negotiation timeout"},Ie={code:1104031,message:"player retry timeout"},Me={code:1104032,message:"player is playing"},Oe={code:1104033,message:"client ip changed"},Se={code:1104034,message:"ttl is over time"},De={code:1104035,message:"reset session push"},Te={code:1104036,message:"session request timeout"},Ae={code:1104037,message:"probe time out"},Ce={code:1104038,message:"resource mode is not supported"},Ne={code:1004002,message:"play stream not found"},ze={code:1004020,message:"play stream interrupted"},ke={code:1104041,message:"stream quality poor and net probe poor"},ye={code:1104042,message:o},Le={code:1104043,message:"mini sdp error"},Ue={code:1104045,message:"play streams is out limit"},qe={code:1104046,message:"play streams auth fail"},we={code:1104099,message:"play streams system error"},Pe={code:1103048,message:n.pt},Xe={code:1103100,message:"background process is start, but not subscribe yet"}},8866:function(e,t,r){r.d(t,{M$:function(){return i},Rl:function(){return g},Wk:function(){return v},aw:function(){return c},dO:function(){return f},fT:function(){return d},gU:function(){return u},h2:function(){return _},jy:function(){return s},l3:function(){return o},pt:function(){return m},qC:function(){return l},zQ:function(){return a}});r(7202),r(8627);var n=r(4872),o=Promise;function i(e){for(var t in e)(0,n.w)(e[t])?i(e[t]):e.hasOwnProperty(t)||((0,n.Cs)(e[t])&&(e[t]=0),(0,n.QP)(e[t])&&(e[t]=""))}function s(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)}function u(e){return!!(e.startsWith("rtmp://")||e.startsWith("avertp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))}function a(e,t){return 0==t?(0,n.Cs)(e)&&e%1==0&&e>=0:(0,n.Cs)(e)&&e%1==0&&e>0}var d="room not exist",m="device is not found",c="stream is not from zego",f="input param error",l="local stream wrong",_="no preview",v="publish stream no found",g="network is broken"},7202:function(e,t,r){var n=r(6994);t.A=n.default||n},4872:function(e,t,r){r.d(t,{$C:function(){return m},Cs:function(){return n},G0:function(){return d},JO:function(){return a},QP:function(){return o},TE:function(){return s},dd:function(){return i},w:function(){return u}});r(2362);function n(e){return"number"==typeof e}function o(e){return"string"==typeof e}function i(e){return"boolean"==typeof e}function s(e){return void 0===e}function u(e){return null!==e&&e instanceof Object}function a(e){return"function"==typeof e}function d(e){return e instanceof Uint8Array}function m(e){return(e.startsWith("preset-id://")||e.startsWith("http")||e.startsWith("https"))&&(e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".png"))}},6994:function(t){t.exports=e},3788:function(e){e.exports=t}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,o),i.exports}o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{MixStream:function(){return B}});var s=o(8627),u={NOT_LOGIN:s.S4u,INPUT_PARAM:s.ZEp,TIMEOUT:s.Q9p,MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_OUTPUT_TARGET_TOO_LONG:{code:1005029,message:"Output stream target is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}},a=o(9022),d=o(3788);const m=o(6994);(d=d.default||d).util.Long=m.default||m,d.util.Long.fromBits=d.util.Long.fromBits||function(){return 0};for(var c=d.roots,f=d.types?d.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},l=d.types?d.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},_=Object.keys(f),v={$:function(e){return v[e]?v[e].call(this):c[e].decode?c[e].decode(this,this.uint32()):v.$.call(this,"int32")}},g={$:function(e,t,r){var n=f[e];return void 0===n?c[e].encode?(this.uint32(r<<3|2).fork(),c[e].encode(t,this).ldelim()):g.$.call(this,"int32",t,r):g[e].call(this.uint32(r<<3|n),t)}},p=0;p<_.length;p++)v[_[p]]=d.Reader.prototype[_[p]],g[_[p]]=d.Writer.prototype[_[p]];!function e(t,r,n,o){for(var i=0,s=Object.keys(t);i<s.length;i++){var u=s[i];if(t[u].$m&&Object.keys(t[u].$m).every((function(e){return Number(e)}))){if(n[u])throw Error(`nested type ${n}.${u} has already exist`);n[u]=function(t,n){function o(e){for(var r in t){var n=t[r];"{"===n[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[])}if(e)for(var o=Object.keys(e),i=0;i<o.length;++i)null!=e[o[i]]&&(this[o[i]]=e[o[i]])}var i={};for(var s in t){var u=t[s],a=u[1];"{"===a.charAt(0)?(o.prototype[u[0]]=d.util.emptyObject,i[a]={$m:a.substring(1).split(",").map((function(e,t){return[`$${t+1}`,e,null]})).reduce((function(e,t,r){return e[r+1]=t,e}),{})}):o.prototype[u[0]]="["===a.charAt(0)||"<"===a.charAt(0)?d.util.emptyArray:"bytes"===a?d.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?d.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return o.create=function(e){return new o(e)},o.decode=function(e,r){e instanceof d.Reader||(e=d.Reader.create(e));for(var n=void 0===r?e.len:e.pos+r,i=new o;e.pos<n;){var s=e.uint32(),u=s>>>3;if(u>0&&t[u]){var a=t[u][0],m=t[u][1];if("{"===m.charAt(0)){i[a]===d.util.emptyObject&&(i[a]={});var f=o.$namespace[m].decode(e,e.uint32());i[a][f.$1]=f.$2}else if("["===m.charAt(0)||"<"===m.charAt(0)){m=m.substring(1),i[a]&&i[a].length||(i[a]=[]);if(void 0!==l[m=!v[m]&&!c[m].decode?"int32":m]&&2==(7&s))for(var _=e.uint32()+e.pos;e.pos<_;)i[a].push(v.$.call(e,m));else i[a].push(v.$.call(e,m))}else i[a]=v.$.call(e,m)}else e.skipType(7&s)}return i},o.encode=function(e,r){for(var n in r||(r=d.Writer.create()),t){var i=t[n][0],s=t[n][1];if("{"===s.charAt(0)){if(null!=e[i]&&e.hasOwnProperty(i))for(var u=0,a=Object.keys(e[i]);u<a.length;++u)r.uint32(n<<3|2).fork(),o.$namespace[s].encode({$1:a[u],$2:e[i][a[u]]},r).ldelim()}else if("["===s.charAt(0)||"<"===s.charAt(0)){var m="<"===s.charAt(0);s=s.substring(1);var _=e[i];if(null!=_&&_.length){if(s=void 0===f[s]&&!c[s].encode?"int32":s,m&&void 0!==l[s]){r.uint32(n<<3|2).fork();for(u=0;u<_.length;u++)g[s].call(r,_[u]);r.ldelim()}else for(u=0;u<_.length;u++)g.$.call(r,s,_[u],n)}}else null!=e[i]&&e.hasOwnProperty(i)&&g.$.call(r,s,e[i],n)}return r},Object.keys(i).length&&(o.$namespace=e(i,r+"."+n,o.$namespace||{},!0)),o}(t[u].$m,u)}else t[u].$s?n[u]=function(e,t){function n(e,t,r){d.rpc.Service.call(this,e,t,r)}return(n.prototype=Object.create(d.rpc.Service.prototype)).constructor=n,n.create=function(e,t,r){return new n(e,t,r)},Object.keys(e).forEach((function(o){var i=e[o];function s(e,t){return this.rpcCall(s,c[i[0]],c[i[1]],e,t)}Object.defineProperty(s,"name",{value:o}),Object.defineProperty(s,"path",{value:`${r}.${t}`}),n.prototype[o]=s})),n}(t[u].$s,u):t[u].$e&&Object.values(t[u].$e).every((function(e){return Number(e)===e}))&&(n[u]=function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[r[t[n]]=e[t[n]]]=t[n];return r}(t[u].$e));n[u]&&!o&&(c[`${r}.${u}`]=n[u]),delete t[u].$m,delete t[u].$s,delete t[u].$e,n[u]=e(t[u],Boolean(r)?`${r}.${u}`:u,n[u]||{})}return n}({mixstream:{proto_mixstream:{AutoRoomMixOutputStream:{$m:{1:["stream_out_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["audio_channel_cnt","int32",0]}},AutoRoomMixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],3:["mix_source","string",""],4:["room_id","string",""],5:["task_id","string",""],6:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],7:["output_stream","<mixstream.proto_mixstream.AutoRoomMixOutputStream",null],8:["extra_params","<mixstream.proto_mixstream.MixAdvanceConfig",null],9:["has_recv_buffer_level","bool",!1],10:["recv_buffer_level","sint32",0]}},AutoRoomMixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},AutoRoomMixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""]}},AutoRoomMixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},GetMixStreamStatusRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},GetMixStreamStatusResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["push_url","<mixstream.proto_mixstream.PushUrl",null],4:["version","int32",0],5:["task_id","string",""]}},MixAdvanceConfig:{$m:{1:["key","string",""],2:["value","string",""]}},MixImage:{$m:{1:["url","string",""],2:["display_mode","int32",0]}},MixInputStream:{$m:{1:["stream_input_common","mixstream.proto_mixstream.MixInputStreamCommon",null],2:["volume","int32",0],3:["audio_focus","int32",0],4:["audio_h_angle","int32",0],5:["render_mode","int32",0],6:["corner_radius","uint32",0],7:["label","mixstream.proto_mixstream.MixLabel",null],8:["image","mixstream.proto_mixstream.MixImage",null]}},MixInputStreamCommon:{$m:{1:["stream_id","string",""],2:["sound_level_id","uint32",0],3:["content_control","int32",0],4:["layer_rect","mixstream.proto_mixstream.MixRect",null],5:["stream_url","string",""]}},MixLabel:{$m:{1:["text","string",""],2:["text_left","int32",0],3:["text_top","int32",0],4:["font","mixstream.proto_mixstream.MixLableFont",null]}},MixLableFont:{$m:{1:["font_type","int32",0],2:["font_size","int32",0],3:["font_color","int32",0],4:["font_transparency","int32",0],5:["font_border_color","sint32",0]}},MixOutputStream:{$m:{1:["output_stream_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["video_enc_id","int32",0],3:["video_encode_latency","int32",0],4:["video_encode_profile","int32",0],5:["low_bitrate_hd","int32",0]}},MixOutputStreamCommon:{$m:{1:["is_url","int32",0],2:["target","string",""],3:["video_fps","int32",0],4:["rate_control_mode","int32",0],5:["video_bitrate","int32",0],6:["video_width","int32",0],7:["video_height","int32",0],8:["output_quality","int32",0],9:["audio_bitrate","int32",0],10:["audio_enc_id","int32",0]}},MixRect:{$m:{1:["top","int32",0],2:["left","int32",0],3:["bottom","int32",0],4:["right","int32",0],5:["layer","int32",0]}},MixStartReplyData:{$m:{1:["request_id","string",""],2:["play_infos","<mixstream.proto_mixstream.PlayInfo",null]}},MixStreamCommon:{$m:{1:["user_data","string",""],2:["output_bg_color","int32",0],3:["output_bg_image","string",""],4:["with_sound_level","int32",0],5:["single_stream_pass_through","int32",0],6:["alignment_type","int32",0]}},MixstreamServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},MixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_protocol_version","int32",0],3:["task_id","string",""],4:["room_id","string",""],5:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],6:["audio_channel_cnt","int32",0],7:["audio_mix_mode","int32",0],8:["recv_buffer_level","sint32",0],9:["input_stream","<mixstream.proto_mixstream.MixInputStream",null],10:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],11:["advance_config","<mixstream.proto_mixstream.MixAdvanceConfig",null],12:["output_stream","<mixstream.proto_mixstream.MixOutputStream",null],13:["white_board","mixstream.proto_mixstream.MixWhiteBoard",null],14:["timestamp","int64",{low:0,high:0,unsigned:!1}],15:["check_image_mode","int32",0]}},MixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["data","mixstream.proto_mixstream.MixStartReplyData",null],4:["error_streamid_list","<string",null]}},MixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""],4:["is_url","int32",0],5:["target","string",""],6:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},MixStreamTaskHbRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},MixStreamTaskHbResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["status","uint32",0],4:["hb_interval","uint32",0]}},MixWaterMark:{$m:{1:["image","string",""],2:["layout_rect","mixstream.proto_mixstream.MixRect",null]}},MixWhiteBoard:{$m:{1:["whiteboard_id","uint64",{low:0,high:0,unsigned:!0}],2:["horizontal_ratio","int32",0],3:["vertical_ratio","int32",0],4:["is_ppt_animation","int32",0],5:["layout_rect","mixstream.proto_mixstream.MixRect",null],6:["background_color","int32",0]}},PlayInfo:{$m:{1:["stream_alias","string",""],2:["rtmp_url","string",""],3:["hls_url","string",""],4:["hdl_url","string",""]}},PushUrl:{$m:{1:["status","int32",0],2:["url","string",""],3:["mod_time","int64",{low:0,high:0,unsigned:!1}],4:["reason","int32",0]}}}}},"",c,!1);var h,b,x=c.mixstream,R=o(7202);h=x.proto_mixstream,(b=(b=o(3788)).default||b).util.Long=R.A,b.configure();var E,I=function(){function e(){}return e.prototype.encodeMixStreamStartReq=function(e){var t=h.MixStreamStartRequest.create(e);return h.MixStreamStartRequest.encode(t).finish()},e.prototype.decodeMixStreamStartRsp=function(e){return h.MixStreamStartResponse.decode(e)},e.prototype.encodeMixStreamStopReq=function(e){var t=h.MixStreamStopRequest.create(e);return h.MixStreamStopRequest.encode(t).finish()},e.prototype.decodeMixStreamStopRsp=function(e){return h.MixStreamStopResponse.decode(e)},e.prototype.encodeGetMixStreamStatusReq=function(e){var t=h.GetMixStreamStatusRequest.create(e);return h.GetMixStreamStatusRequest.encode(t).finish()},e.prototype.decodeGetMixStreamStatusRsp=function(e){return h.GetMixStreamStatusResponse.decode(e)},e.prototype.encodeAutoRoomMixStreamStartReq=function(e){var t=h.AutoRoomMixStreamStartRequest.create(e);return h.AutoRoomMixStreamStartRequest.encode(t).finish()},e.prototype.decodeAutoRoomMixStreamStartRsp=function(e){return h.AutoRoomMixStreamStartResponse.decode(e)},e.prototype.encodeAutoRoomMixStreamStopReq=function(e){var t=h.AutoRoomMixStreamStopRequest.create(e);return h.AutoRoomMixStreamStopRequest.encode(t).finish()},e.prototype.decodeAutoRoomMixStreamStopRsp=function(e){return h.AutoRoomMixStreamStopResponse.decode(e)},e.prototype.encodeMixStreamTaskHbReq=function(e){var t=h.MixStreamTaskHbRequest.create(e);return h.MixStreamTaskHbRequest.encode(t).finish()},e.prototype.decodeMixStreamTaskHbRsp=function(e){return h.MixStreamTaskHbResponse.decode(e)},e}(),M=o(5095),O={event:"/mix/start_mix",error:{t:u.INPUT_PARAM,i:u.MIXER_TASK_ID_NULL,u:u.MIXER_TASK_ID_TOO_LONG,m:u.MIXER_TASK_ID_INVALID_CHARACTER,l:u.MIXER_INPUTLIST_NULL,_:u.MIXER_OUTPUTLIST_NULL,v:u.MIXER_OUTPUT_TARGET_INVALID,p:u.MIXER_NO_OUTPUT_TARGET,R:u.MIXER_OUTPUT_TARGET_TOO_LONG,O:u.MIXER_START_REQUEST_ERROR,S:u.MIXER_INNER_ERROR,D:u.MIXER_INPUT_LABEL_TOO_LONG,T:u.MIXER_INPUT_IMAGE_URL_TOO_LONG,C:u.MIXER_INPUT_IMAGE_FORMAT_WRONG,N:u.MIXER_WATERMARK_URL_INVALID,k:u.MIXER_WATERMARK_PARAMETERS_ERROR,U:u.NOT_LOGIN},mix_stream_conf:M.Gq,stop_reason:M.tK},S={event:"/mix/stop_mix",error:{t:u.INPUT_PARAM,i:u.MIXER_TASK_ID_NULL,O:u.MIXER_STOP_REQUEST_ERROR,S:u.MIXER_INNER_ERROR,U:u.NOT_LOGIN}},D={event:"/mix/config_mix",error:{t:u.INPUT_PARAM,q:u.MIXER_VIDEO_CONFIG_INVALID,P:u.MIXER_BACKGROUND_IMAGE_URL_INVALID,U:u.NOT_LOGIN},mix_params:M.Gq},T="/automix/start",A="/automix/stop",C=o(4872),N=o(8866),z=o(4908),k=function(){return k=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},k.apply(this,arguments)},y=256,L=1024,U=1e4;E=R.A;var q,w,P=["NO_RELAY","RELAYING","RELAY_REQUESTING","NO_RELAY"],X={0:"NONE",8:"SERVER_ERROR",9:"HANDSHAKE_FAILED",10:"ACCESS_POINT_ERROR",11:"CREATE_STREAM_FAILED",12:"BAD_NAME",13:"CDN_SERVER_DISCONNECTED",14:"DISCONNECTED",1214:"ALL_INPUT_STREAM_CLOSED",1215:"ALL_INPUT_STREAM_NO_DATA",1230:"SERVER_INTERNAL_ERROR"};function $(e,t){var r,n,o,i,s="",a=u;return t.errorCode<2e9&&t.errorCode>1e9?(o={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},i="MIXER_INNER_ERROR",(n=t.errorCode-U)>1e9&&o[n-1e9]&&(i=o[n-1e9]),r=a[s=i]):t.errorCode<1e6&&(r=e.decodeServerError(t.errorCode,t.extendedData),s=e.getLiveRoomError(t.errorCode)),{reportErr:r,actualError:a[s]}}(w=q||(q={}))[w.I=0]="I",w[w.H=10]="H",w[w.M=100]="M",w[w.L=1e3]="L";var j,F,G={VIDEO:0,AUDIO:1,VIDEO_ONLY:2},H={"H.264":0,"H.265":3};function V(e){var t=j.AUDIO_ENC_HE_AAC;switch(e){case a.Xk.ZegoAudioCodecIDNormal2:t=j.AUDIO_ENC_AAC_LC;break;case a.Xk.ZegoAudioCodecIDLow3:t=j.AUDIO_ENC_OPUS;break;default:t=j.AUDIO_ENC_HE_AAC}return t}(F=j||(j={}))[F.AUDIO_ENC_HE_AAC=0]="AUDIO_ENC_HE_AAC",F[F.AUDIO_ENC_AAC_LC=1]="AUDIO_ENC_AAC_LC",F[F.AUDIO_ENC_MP3=2]="AUDIO_ENC_MP3",F[F.AUDIO_ENC_OPUS=3]="AUDIO_ENC_OPUS",F[F.AUDIO_ENC_SILK=4]="AUDIO_ENC_SILK",F[F.AUDIO_ENC_EVS=5]="AUDIO_ENC_EVS";var Z={},J={startMixerTask:function(e){var t=this;return new N.l3((function(r,n){var o,i,s,a,d,m,c,f,l,_,v,g,p,h,b=t.reporter.createSpan(q.H,{key:z.oq.event},{key:O.event,par:e.taskID},O.event,!0),x={errorCode:u.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:u.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(x.extendedData=x.extendedData+". streamID should be of string type",!0)}))))return t.reporter.setError(b,u.MIXER_INPUT_PARAMETERS_ERROR),void n(x);var R=e.outputConfig;R&&R.outputFps&&(R.outputFPS=R.outputFps);var E=function(r){var o=$(t.stateCenter,r),i=o.reportErr,s=o.actualError;1000010150===r.errorCode&&b.setAttributes({stop_reason:"UnmatchStreamId"}),t.reporter.setError(b,i||r),t.reporter.spanEnd({key:O.event,par:e.taskID}),s&&(r.errorCode=null==s?void 0:s.code,r.extendedData=(null==s?void 0:s.message)||""),n(r)},I=t.stateCenter.roomList[0];if(I){var M=[];if(!e.noTaskID&&!e.taskID)return t.logger.error("zb.sh.ums no taskId found"),void E({errorCode:O.error.i.code,extendedData:O.error.i.message});if(!e.noTaskID&&!(0,C.QP)(e.taskID))return t.logger.error("zb.rh.lg taskId must be string"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!e.noTaskID&&e.taskID.length>y)return t.logger.error("zb.sh.ums taskId is too long"),void E({errorCode:O.error.u.code,extendedData:O.error.u.message});if(!e.noTaskID&&!(0,N.jy)(e.taskID))return t.logger.error("zb.sh.ums task ID contains illegal characters"),void E({errorCode:O.error.m.code,extendedData:O.error.m.message});if(!e.inputList||0==e.inputList.length)return t.logger.error("zb.sh.ums input list wrong"),void E({errorCode:O.error.l.code,extendedData:O.error.l.message});if(e.inputList.some((function(e){return(0,C.w)(e)&&!e.streamID})))return t.logger.error("zb.sh.ums input stream is null"),void E({errorCode:O.error.l.code,extendedData:O.error.l.message});for(var S=0;S<e.inputList.length;S++){var D=e.inputList[S],T={errorCode:O.error.t.code,extendedData:O.error.t.message};if(!(0,C.w)(D.layout))return t.logger.error("zb.sh.ums input layout must be object"),void E(T);var A=D.layout,k=A.bottom,U=A.left,w=A.right;if(!((0,N.zQ)(A.top,!1)&&(0,N.zQ)(k,!1)&&(0,N.zQ)(U,!1)&&(0,N.zQ)(w,!1)))return t.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),void E(T);if(void 0!==D.renderMode&&![0,1].includes(D.renderMode))return t.logger.error("zb.sh.ums render_mode is wrong"),void E(T);if(void 0!==D.imageInfo){if(!(0,C.QP)(D.imageInfo.url))return t.logger.error("zb.sh.ums image url is require string"),void E(T);if(D.imageInfo.url.length>1024)return t.logger.error("zb.sh.ums input image url length too long"),void E({errorCode:O.error.T.code,extendedData:O.error.T.message})}if(!(0,C.TE)(D.label)){if(!(0,C.QP)(null===(o=D.label)||void 0===o?void 0:o.text))return t.logger.error("zb.sh.ums input label text is not string"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message+" label text is not string"});if((null===(s=null===(i=D.label)||void 0===i?void 0:i.text)||void 0===s?void 0:s.length)>=300)return t.logger.error("zb.sh.ums input label text is  too long"),void E({errorCode:O.error.D.code,extendedData:O.error.D.message});var P=D.label,X=P.left,j=P.top;if(void 0!==X&&!(0,N.zQ)(X,!1)||void 0!==j&&!(0,N.zQ)(j,!1))return t.logger.error("zb.sh.ums input label left and top should be integer"),void E(T)}if(void 0!==D.cornerRadius&&!(0,C.Cs)(D.cornerRadius))return t.logger.error("zb.sh.ums cornerRadius is wrong"),void E(T);if(void 0!==D.soundLevelID&&!(0,N.zQ)(D.soundLevelID,!1))return t.logger.error("zb.sh.ums soundLevelID is wrong"),void E(T);if(void 0!==D.volume&&!(0,N.zQ)(D.volume,!1))return t.logger.error("zb.sh.ums volume is wrong"),void E(T)}if(!e.outputList||0==e.outputList.length)return t.logger.error("zb.sh.ums no output list found"),void E({errorCode:O.error._.code,extendedData:O.error._.message});if(e.outputList.some((function(e){return(0,C.QP)(e)&&!(0,N.gU)(e)&&""===e||(0,C.w)(e)&&!e.target})))return t.logger.error("zb.sh.ums stream output target is nul"),void E({errorCode:O.error._.code,extendedData:O.error._.message});if(e.outputList.some((function(e){return(0,C.QP)(e)&&!(0,N.gU)(e)&&e.length>L||(0,C.w)(e)&&(0,C.QP)(e.target)&&e.target.length>L})))return t.logger.error("zb.sh.ums stream output target is too long"),void E({errorCode:O.error.R.code,extendedData:O.error.R.message});if(e.outputList.some((function(e){return(0,C.QP)(e)&&!(0,N.gU)(e)&&!(0,N.jy)(e)||(0,C.w)(e)&&e.target&&!(0,N.gU)(e.target)&&!(0,N.jy)(e.target)})))return t.logger.error("zb.sh.ums stream output target is incorrect"),void E({errorCode:O.error.v.code,extendedData:O.error.v.message});if(!R||!(0,C.w)(R))return t.logger.error("zb.sh.ums no output config found"),void E({errorCode:O.error.p.code,extendedData:O.error.p.message});if(!R.outputBitrate||!(0,N.zQ)(R.outputBitrate))return t.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!R.outputFPS||!(0,N.zQ)(R.outputFPS))return t.logger.error("zb.sh.ums fps param is required and must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!R.outputWidth||!(0,N.zQ)(R.outputWidth))return t.logger.error("zb.sh.ums width param is required and must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!R.outputHeight||!(0,N.zQ)(R.outputHeight))return t.logger.error("zb.sh.ums height param is required and must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(void 0!==R.outputAudioCodecID&&!(0,N.zQ)(R.outputAudioCodecID,!1))return t.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(void 0!==R.outputAudioBitrate&&!(0,N.zQ)(R.outputAudioBitrate))return t.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(void 0!==R.outputAudioChannels&&!(0,N.zQ)(R.outputAudioChannels,!1))return t.logger.error("zb.sh.ums AudioChannels param must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.TE)(e.watermark)){if(!(0,C.QP)(null===(a=e.watermark)||void 0===a?void 0:a.imageURL))return t.logger.error("zb.sh.ums watermark image type error"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.$C)(null===(d=e.watermark)||void 0===d?void 0:d.imageURL))return t.logger.error("zb.sh.ums watermark image url invalid"),void E({errorCode:O.error.N.code,extendedData:O.error.N.message});if(!(0,C.w)(null===(m=e.watermark)||void 0===m?void 0:m.layout))return t.logger.error("zb.sh.ums watermark layout must be object"),void E({errorCode:O.error.k.code,extendedData:O.error.k.message});var F=null===(c=e.watermark)||void 0===c?void 0:c.layout;k=F.bottom,U=F.left,w=F.right;if(!((0,N.zQ)(F.top,!1)&&(0,N.zQ)(k,!1)&&(0,N.zQ)(U,!1)&&(0,N.zQ)(w,!1)))return t.logger.error("zb.sh.ums watermark top、left、bottom、right must be integer number"),void E({errorCode:O.error.k.code,extendedData:O.error.k.message})}if(!(0,C.TE)(e.whiteboard)){if(!(0,C.QP)(null===(f=e.whiteboard)||void 0===f?void 0:f.whiteboardID))return t.logger.error("zb.sh.ums whiteboard is required and must be string"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.w)(null===(l=e.whiteboard)||void 0===l?void 0:l.layout))return t.logger.error("zb.sh.ums whiteboard layout must be object"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});var H=null===(_=e.whiteboard)||void 0===_?void 0:_.layout;k=H.bottom,U=H.left,w=H.right;if(!((0,N.zQ)(H.top,!1)&&(0,N.zQ)(k,!1)&&(0,N.zQ)(U,!1)&&(0,N.zQ)(w,!1)))return t.logger.error("zb.sh.ums whiteboard top、left、bottom、right must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});var V=e.whiteboard,J=V.horizontalRatio,W=V.verticalRatio,B=V.isPPTAnimation,K=V.zOrder,Q=V.backgroundColor;if(!(0,C.TE)(J)&&!(0,N.zQ)(J))return t.logger.error("zb.sh.ums horizontalRatio must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.TE)(W)&&!(0,N.zQ)(W))return t.logger.error("zb.sh.ums verticalRatio must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.TE)(B)&&!(0,C.dd)(B))return t.logger.error("zb.sh.ums isPPTAnimation must be boolean"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.TE)(K)&&!(0,N.zQ)(K,!1))return t.logger.error("zb.sh.ums zOrder must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});if(!(0,C.TE)(Q)&&!(0,N.zQ)(Q,!1))return t.logger.error("zb.sh.ums backgroundColor must be integer number"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message})}if(!(0,C.TE)(e.enableSoundLevel)&&!(0,C.dd)(e.enableSoundLevel))return t.logger.error("zb.sh.ums enableSoundLevel is not bool"),void E({errorCode:O.error.t.code,extendedData:O.error.t.message});for(S=0;S<e.inputList.length;S++){var Y=e.inputList[S],ee=Y.streamID;t.stateCenter.testEnvironment&&(ee="zegotest-"+t.stateCenter.appid+"-"+Y.streamID),M.push({stream_id:ee,content_control:G[Y.contentType||"VIDEO"]||0,top:null===(v=Y.layout)||void 0===v?void 0:v.top,left:null===(g=Y.layout)||void 0===g?void 0:g.left,bottom:null===(p=Y.layout)||void 0===p?void 0:p.bottom,right:null===(h=Y.layout)||void 0===h?void 0:h.right,render_mode:Y.renderMode,image:Y.imageInfo,label:Y.label})}var te=[];e.outputList.forEach((function(e){var t="";(0,C.QP)(e)?t=e:(0,C.w)(e)&&e.target&&(t=e.target);var r=0;(t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))&&(r=1),te.push({target:t,is_url:r?"true":"false"})}));t.reporter.spanSetAttributes({key:O.event,par:e.taskID},{mix_stream_conf:O.mix_stream_conf({fps:R.outputFPS,bitrate:R.outputBitrate,w:R.outputWidth,h:R.outputHeight,stream_cnt:M.length,mix_task_id:e.taskID,input_stream_list:M,output_target_list:te})}),I.streamHandler.updateMixStream(e,Z,(function(n){t.reporter.spanEnd({key:O.event,par:e.taskID}),r(n)}),E)}else E({errorCode:O.error.U.code,extendedData:O.error.U.message})}))},setMixerTaskConfig:function(e){var t=this;return new N.l3((function(r,n){var o,i=t.reporter.createSpan(q.H,{key:z.oq.event},{key:""},D.event),s={},u=function(e){t.reporter.setError(i,e),n(e)};if(e&&e.videoCodec){var a=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(a))return t.logger.error("zb.sh.ums param videoCode error"),u({errorCode:D.error.q.code,extendedData:D.error.q.message}),!1;s.videoCodec=a}if(e.backgroundColor){if(!(0,N.zQ)(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),u({errorCode:D.error.t.code,extendedData:D.error.t.message}),!1;s.backgroundColor=e.backgroundColor}var d=e.backgroundImage;if(d){if(!(0,C.QP)(d))return t.logger.error("zb.sh.ums param outputBgImage error"),u({errorCode:D.error.t.code,extendedData:D.error.t.message}),!1;if(!(0,C.$C)(d))return t.logger.error("zb.sh.ums illegal input background image URL"),u({errorCode:D.error.P.code,extendedData:D.error.P.message}),!1;s.backgroundImage=d}var m=e&&e.userData;if(m){if(!(0,C.G0)(m))return t.logger.error("zb.sh.ums param userData required Uint8Array"),u({errorCode:D.error.t.code,extendedData:D.error.t.message}),!1;if(m.byteLength>1e3)return t.logger.error("zb.sh.ums param userData should shorter than 1000"),u({errorCode:D.error.t.code,extendedData:D.error.t.message}),!1;s.userData=m}e.extraParams&&(s.extraParams||(s.extraParams=[]),(o=s.extraParams).push.apply(o,e.extraParams)),Z=s,i.setAttributes({mix_params:D.mix_params(e)}),t.stateCenter.roomList[0]?(i.end(),r({errorCode:0,extendedData:""})):u({errorCode:D.error.U.code,extendedData:D.error.U.message})}))},stopMixerTask:function(e){var t=this;return new N.l3((function(r,n){var o=t.reporter.createSpan(q.H,{key:z.oq.event},{key:""},S.event);if(!e||!(0,C.QP)(e)||e.length>y||!(0,N.jy)(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.reporter.setError(o,S.error.t," param taskID error"),void n({errorCode:S.error.t.code,extendedData:S.error.t.message+" param taskID error"});o.setAttributes({mix_task_id:e});var i=function(e){var r=$(t.stateCenter,e),i=r.actualError;t.reporter.setError(o,r.reportErr||e),i&&(e.errorCode=null==i?void 0:i.code,e.extendedData=(null==i?void 0:i.message)||""),n(e)},s=t.stateCenter.roomList[0];s?s.streamHandler.stopMixStream(e,(function(e){o.end(),r(e)}),i):i({errorCode:S.error.U.code,extendedData:S.error.U.message})}))},startAutoMixerTask:function(e){var t=this;return new N.l3((function(r,n){var o,i,u=t.reporter.createSpan(q.H,{key:z.oq.event},{key:T,par:e.taskID},T,!0),a=function(r){var o=$(t.stateCenter,r),i=o.reportErr;1000010150===r.errorCode&&u.setAttributes({stop_reason:"UnmatchStreamId"}),t.reporter.setError(u,i||r),t.reporter.spanEnd({key:T,par:e.taskID}),n(r)},d=t.stateCenter.roomList[0];if(d){if(!e.taskID)return t.logger.error("zb.sh.ums no taskId found"),void a({errorCode:O.error.i.code,extendedData:O.error.i.message});if(!(0,C.QP)(e.taskID))return t.logger.error("zb.rh.lg taskId must be string"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message});if(e.taskID.length>y)return t.logger.error("zb.sh.ums taskId is too long"),void a({errorCode:O.error.u.code,extendedData:O.error.u.message});if(!(0,N.jy)(e.taskID))return t.logger.error("zb.sh.ums task ID contains illegal characters"),void a({errorCode:O.error.m.code,extendedData:O.error.m.message});if(!e.roomID)return t.logger.error("zb.sh.ums no roomID found"),void a({errorCode:s.Qo5.code,extendedData:s.Qo5.message});if(!(0,C.QP)(e.roomID))return t.logger.error("zb.rh.lg roomID must be string"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message});if(e.roomID.length>128)return t.logger.error("zb.sh.ums roomID is too long"),void a({errorCode:s.Srw.code,extendedData:s.Srw.message});if(!(0,N.jy)(e.roomID))return t.logger.error("zb.sh.ums room ID contains illegal characters"),void a({errorCode:s.ulL.code,extendedData:s.ulL.message});if(!e.outputList||0==e.outputList.length)return t.logger.error("zb.sh.ums no output list found"),void a({errorCode:O.error._.code,extendedData:O.error._.message});if(e.outputList.some((function(e){return(0,C.w)(e)&&!e.target})))return t.logger.error("zb.sh.ums stream output target is nul"),void a({errorCode:O.error._.code,extendedData:O.error._.message});if(e.outputList.some((function(e){return(0,C.w)(e)&&(0,C.QP)(e.target)&&e.target.length>L})))return t.logger.error("zb.sh.ums stream output target is too long"),void a({errorCode:O.error.R.code,extendedData:O.error.R.message});if(e.outputList.some((function(e){return(0,C.w)(e)&&e.target&&!(0,N.gU)(e.target)&&!(0,N.jy)(e.target)})))return t.logger.error("zb.sh.ums stream output target is incorrect"),void a({errorCode:O.error.v.code,extendedData:O.error.v.message});if(e.audioConfig){if(void 0!==(null===(o=e.audioConfig)||void 0===o?void 0:o.bitrate)&&!(0,N.zQ)(null===(i=e.audioConfig)||void 0===i?void 0:i.bitrate))return t.logger.error("zb.sh.ums audio bitrate param is required and must be integer number"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message});if(void 0!==e.audioConfig.codecID&&!(0,N.zQ)(e.audioConfig.codecID,!1))return t.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message});if(void 0!==e.audioConfig.channel&&![1,2].includes(e.audioConfig.channel))return t.logger.error("zb.sh.ums AudioChannels param must be 1 or 2"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message})}if(!(0,C.TE)(e.enableSoundLevel)&&!(0,C.dd)(e.enableSoundLevel))return t.logger.error("zb.sh.ums enableSoundLevel is not bool"),void a({errorCode:O.error.t.code,extendedData:O.error.t.message});e.outputList.forEach((function(e){var t="";(0,C.QP)(e)?t=e:(0,C.w)(e)&&e.target&&(t=e.target);t.startsWith("rtmp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8")})),t.reporter.spanSetAttributes({key:T,par:e.taskID},{task_id:e.taskID,room_id:e.roomID,with_sound_level:e.enableSoundLevel?1:0,alignment_type:e.streamAlignmentMode||0,recv_buffer_level:e.minPlayStreamBufferLength||0,output_target_list:[]}),d.streamHandler.updateAutoMixStream(e,(function(n){t.reporter.spanEnd({key:T,par:e.taskID}),r(n)}),a)}else a({errorCode:O.error.U.code,extendedData:O.error.U.message})}))},stopAutoMixerTask:function(e){var t=this;return new N.l3((function(r,n){var o=t.reporter.createSpan(q.H,{key:z.oq.event},{key:""},A);if(!e.taskID||!(0,C.QP)(e.taskID)||e.taskID.length>y||!(0,N.jy)(e.taskID))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.reporter.setError(o,S.error.t," param taskID error"),void n({errorCode:S.error.t.code,extendedData:S.error.t.message+" param taskID error"});o.setAttributes({task_id:e.taskID,room_id:e.roomID});var i=function(e){var r=$(t.stateCenter,e);t.reporter.setError(o,r.reportErr||e),n(e)},s=t.stateCenter.roomList[0];s?s.streamHandler.stopAutoMixStream(e,(function(e){o.end(),r(e)}),i):i({errorCode:S.error.U.code,extendedData:S.error.U.message})}))}},W={_sendMixStopReqByAccessHub:function(e,t,r){var n=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new I),e.timestamp=E.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.1 req "+JSON.stringify(e));var o=this.mixStreamProtoBuf.encodeMixStreamStopReq(e),i=function(t,r){try{var o=n.mixStreamProtoBuf.decodeMixStreamStopRsp(t);(0,N.M$)(o),n.logger.info("zb.sh.smseba.1 rsp "+JSON.stringify(e));var i=(null==o?void 0:o.common_response)||{};return{code:i.code,msg:i.message}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:16},o,(function(e,n){var o=i(e),s=o.code,u=o.msg;0!=s&&null!=s||!(0,C.JO)(t)?r&&r({errorCode:s,extendedData:u||""}):t({errorCode:s,extendedData:u})}),(function(e,t,o){var s="";if(o)return o.code==u.TIMEOUT.code&&(o=O.error.S),o.code&&20010===o.code&&(o=JSON.parse(JSON.stringify(u.MIXER_NO_SERVICES))),void(r&&r(o,s));o=O.error.S;var a="";if((0,C.QP)(t))a=t;else{var d=i(t);a=d.code+" "+d.msg}n.logger.error("zb.sh.pt "+(s="request media server fail, error: "+e+" "+a)),r&&r(o,s)}))},stopMixStream:function(e,t,r,n,o){var i=this;this.logger.info("zb.sh.sms call");var s=this.getStopMixStreamParams(e,n,o);this._sendMixStopReqByAccessHub(s.mixStopReq,(function(r){i.mixStreamHbList[e]&&(i.mixStreamHbList[e].timer&&clearTimeout(i.mixStreamHbList[e].timer),delete i.mixStreamHbList[e]),t(r)}),r)},_sendMixStartReqByAccessHub:function(e,t,r,n){var o=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new I),e.timestamp=E.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.0 req "+JSON.stringify(e));var i=this.mixStreamProtoBuf.encodeMixStreamStartReq(e),s=function(e,t){try{var r=o.mixStreamProtoBuf.decodeMixStreamStartRsp(e);(0,N.M$)(r),o.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,data:r.data,errStreamList:r.error_streamid_list}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:15},i,(function(i,u){var a=s(i),d=a.code,m=a.data,c=a.errStreamList;if(void 0===d||0==d){var f=m.play_infos.map((function(e){var r={rtmpURL:"",hlsURL:"",flvURL:""},n=e.stream_alias||"";return o.stateCenter.testEnvironment&&n&&n.startsWith(t)&&(n=n.slice(t.length)),r.streamID=n,e.rtmp_url&&e.rtmp_url.length>0&&(r.rtmpURL=e.rtmp_url),e.hls_url&&e.hls_url.length>0&&(r.hlsURL=e.hls_url),e.hdl_url&&e.hdl_url.length>0&&(r.flvURL=e.hdl_url),r}));if(m.request_id){o.mixStreamTaskList[e.task_id]||(o.mixStreamTaskList[e.task_id]={mixStatusVer:0,requestId:m.request_id}),o.mixStreamTaskList[e.task_id].requestId=m.request_id;var l=o.mixRequestIdList.findIndex((function(e){return e==m.request_id}));l>-1&&(o.fetchMixStreamStatus(o.stateCenter.appid+":"+e.task_id),o.mixRequestIdList.splice(l,1))}if(r)r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:f})})}else{var _="",v=d+1e9;if(1000000150==v&&c){var g=c.map((function(e){return o.stateCenter.testEnvironment&&e.startsWith(t)?e.slice(t.length):e}))||[];g.length>0&&(o.logger.debug("zb.sh.ums not exist streams: "+g),_=g.join(","))}n&&n({errorCode:o.stateCenter.getServerError(U+v).code,extendedData:_})}}),(function(e,t,r){var i="";if(r)return r.code==u.TIMEOUT.code&&(r=O.error.O),r.code&&20010===r.code&&(r=JSON.parse(JSON.stringify(u.MIXER_NO_SERVICES))),void(n&&n(r,i));r=O.error.S;var a="";if((0,C.QP)(t))a=t;else{var d=s(t);a=d.code+" "+d.msg}o.logger.error("zb.sh.pt "+(i="request media server fail, error: "+e+" "+a)),n&&n(r,i)}))},getStartMixStreamParams:function(e,t){var r,n,o=this,i={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:e.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]},s=e.outputConfig||{};s.singleStreamPassThrough&&(0,C.dd)(s.singleStreamPassThrough)&&(i.mix_stream_common.single_stream_pass_through=s.singleStreamPassThrough?1:0);var u=t;if(u&&(u.videoCodec&&(null===(r=i.advance_config)||void 0===r||r.push({key:"video_encode",value:u.videoCodec})),u.backgroundColor&&(i.mix_stream_common.output_bg_color=u.backgroundColor),u.backgroundImage&&(i.mix_stream_common.output_bg_image=u.backgroundImage),u.userData&&(i.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(u.userData)),u.extraParams&&(null===(n=i.advance_config)||void 0===n||n.push.apply(n,u.extraParams))),void 0!==e.enableSoundLevel&&(i.mix_stream_common.with_sound_level=e.enableSoundLevel?1:0),e.inputList.forEach((function(e,t){var r,n,s,u,a,d,m,c,f,l,_,v,g,p,h,b,x,R,E,I,M,O=e.streamID;o.stateCenter.testEnvironment&&(O="zegotest-"+o.stateCenter.appid+"-"+e.streamID);var S={stream_input_common:{stream_id:O,content_control:G[e.contentType||"VIDEO"]||0,layer_rect:{layer:t,top:null===(r=e.layout)||void 0===r?void 0:r.top,left:null===(n=e.layout)||void 0===n?void 0:n.left,bottom:null===(s=e.layout)||void 0===s?void 0:s.bottom,right:null===(u=e.layout)||void 0===u?void 0:u.right}},volume:null!==(a=e.volume)&&void 0!==a?a:100,audio_focus:e.isAudioFocus?1:0,audio_h_angle:-1,render_mode:e.renderMode,corner_radius:e.cornerRadius};if(null===(d=e.label)||void 0===d?void 0:d.text){var D={font_type:(null===(c=null===(m=e.label)||void 0===m?void 0:m.font)||void 0===c?void 0:c.type)||0,font_size:(null===(l=null===(f=e.label)||void 0===f?void 0:f.font)||void 0===l?void 0:l.size)||24,font_color:(null===(v=null===(_=e.label)||void 0===_?void 0:_.font)||void 0===v?void 0:v.color)||16777215,font_transparency:(null===(p=null===(g=e.label)||void 0===g?void 0:g.font)||void 0===p?void 0:p.transparency)||0};D.font_border_color=(null===(b=null===(h=e.label)||void 0===h?void 0:h.font)||void 0===b?void 0:b.border)?null===(R=null===(x=e.label)||void 0===x?void 0:x.font)||void 0===R?void 0:R.borderColor:-1;var T={text:null===(E=e.label)||void 0===E?void 0:E.text,text_left:(null===(I=e.label)||void 0===I?void 0:I.left)||0,text_top:(null===(M=e.label)||void 0===M?void 0:M.top)||0,font:D};S.label=T}e.imageInfo&&(S.image={url:e.imageInfo.url,display_mode:e.imageInfo.displayMode||0}),e.soundLevelID&&(S.stream_input_common.sound_level_id=e.soundLevelID),i.input_stream.push(S)})),e.outputList.forEach((function(e){var t,r,n,d,m,c,f,l,_,v,g,p,h,b="";if((0,C.QP)(e)?b=e:(0,C.w)(e)&&e.target?b=e.target:o.logger.error("zb.sh.ums output target required"),(0,N.gU)(b))p=1,h=b;else{p=0,h=o.stateCenter.testEnvironment?"zegotest-"+o.stateCenter.appid+"-"+b:b}var x=s.outputBitrate;"string"!=typeof e&&(null===(t=e.videoConfig)||void 0===t?void 0:t.bitrate)&&(x=null===(r=e.videoConfig)||void 0===r?void 0:r.bitrate);var R={is_url:p,target:h,video_bitrate:1e3*x,video_fps:s.outputFPS,video_width:s.outputWidth,video_height:s.outputHeight,output_quality:23};s.outputAudioCodecID&&(R.audio_enc_id=s.outputAudioCodecID),"vp8"===u.videoCodec?R.audio_enc_id=3:"h264"===u.videoCodec&&(R.audio_enc_id=0),s.outputAudioBitrate&&(R.audio_bitrate=1e3*s.outputAudioBitrate);var E={output_stream_common:R};"string"!=typeof e&&((null===(n=e.videoConfig)||void 0===n?void 0:n.videoCodecID)&&(E.video_enc_id=H[null===(d=e.videoConfig)||void 0===d?void 0:d.videoCodecID]||0),(null===(m=e.videoConfig)||void 0===m?void 0:m.encodeProfile)&&[0,1,2,3].includes(null===(c=e.videoConfig)||void 0===c?void 0:c.encodeProfile)&&(E.video_encode_profile=function(e){var t=1;switch(e){case a.zN.ZegoEncodeProfileDefault:case a.zN.ZegoEncodeProfileMain:t=1;break;case a.zN.ZegoEncodeProfileBaseline:t=0;break;case a.zN.ZegoEncodeProfileHigh:t=2}return t}(null===(f=e.videoConfig)||void 0===f?void 0:f.encodeProfile)),(0,C.Cs)(null===(l=e.videoConfig)||void 0===l?void 0:l.encodeLatency)&&(E.video_encode_latency=null===(_=e.videoConfig)||void 0===_?void 0:_.encodeLatency),(0,C.dd)(null===(v=e.videoConfig)||void 0===v?void 0:v.enableLowBitrateHD)&&(E.low_bitrate_hd=(null===(g=e.videoConfig)||void 0===g?void 0:g.enableLowBitrateHD)?1:0)),i.output_stream.push(E)})),e.watermark&&(i.water_mark={image:e.watermark.imageURL,layout_rect:e.watermark.layout}),e.whiteboard){var d=e.whiteboard,m=d.horizontalRatio,c=d.verticalRatio,f=d.layout,l=d.zOrder,_=d.isPPTAnimation,v=d.backgroundColor;i.white_board={whiteboard_id:E.fromString(d.whiteboardID),horizontal_ratio:m||16,vertical_ratio:c||9,is_ppt_animation:!0===_?1:0,layout_rect:k(k({},f),{layer:l||0}),background_color:v||4059296768}}return isNaN(e.streamAlignmentMode)||(i.mix_stream_common.alignment_type=e.streamAlignmentMode),i.audio_channel_cnt=s.outputAudioChannels?s.outputAudioChannels:1,s.audioMixMode&&(i.audio_mix_mode=s.audioMixMode),{mixStartReq:i}},updateMixStream:function(e,t,r,n){var o=this;this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var i=this.getStartMixStreamParams(e,t).mixStartReq;return this._sendMixStartReqByAccessHub(i,"zegotest-"+this.stateCenter.appid+"-",(function(t){o.startMixHb(e.taskID),r(t)}),n),!0},updateAutoMixStream:function(e,t,r){var n=this;this.logger.info("zb.sh.uams.0 call");var o=e.taskID,i=e.roomID,s=e.audioConfig,u=e.outputList,a=e.enableSoundLevel,d=e.streamAlignmentMode,m=e.minPlayStreamBufferLength;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new I);var c=[];u.forEach((function(e){var t=e.target,r=0;(t.startsWith("rtmp://")||t.startsWith("avertp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))&&(r=1),c.push({stream_out_common:{target:t,is_url:r,audio_bitrate:(null==s?void 0:s.bitrate)?1e3*(null==s?void 0:s.bitrate):48e3,audio_enc_id:(0,C.TE)(null==s?void 0:s.codecID)?0:V(null==s?void 0:s.codecID),video_fps:1,video_bitrate:1,video_width:1,video_height:1},audio_channel_cnt:(null==s?void 0:s.channel)||1})}));var f={request_seq:this.stateCenter.getSeq(),mix_stream_common:{with_sound_level:a?1:0,alignment_type:d},room_id:i,task_id:o,output_stream:c};(0,C.Cs)(m)&&m>=0&&(f.has_recv_buffer_level=!0,f.recv_buffer_level=m),this.logger.info("zb.sh.uams.0 params "+JSON.stringify(f));var l=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStartReq(f),_=function(e,t){try{var r=n.mixStreamProtoBuf.decodeAutoRoomMixStreamStartRsp(e);(0,N.M$)(r),n.logger.info("zb.sh.uams.0 rsp "+JSON.stringify(r));var o=r.common_response;return{code:o.code,msg:o.message}}catch(e){return{code:-1}}};return this.sendMixRequest({interfaceID:10},l,(function(e,o){n.mixSucFun(e,t,r,_,"zb.sh.uams.0")}),(function(e,t,o){n.mixFailFun(e,t,o,r,_,"zb.sh.uams.0")}),6),!0},stopAutoMixStream:function(e,t,r){var n=this,o=e.taskID,i=e.roomID,s={request_seq:this.stateCenter.getSeq(),room_id:i,task_id:o};this.logger.info("zb.sh.uams.1 params "+JSON.stringify(s));var u=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStopReq(s),a=function(e,t){try{var r=n.mixStreamProtoBuf.decodeAutoRoomMixStreamStopRsp(e);(0,N.M$)(r),n.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(r));var o=r.common_response;return{code:o.code,msg:o.message}}catch(e){return{code:-1}}};this.sendMixRequest({interfaceID:11},u,(function(e,o){n.mixSucFun(e,t,r,a,"zb.sh.uams.1")}),(function(e,t,o){n.mixFailFun(e,t,o,r,a,"zb.sh.uams.1")}),6)},mixSucFun:function(e,t,r,n,o,i){var s=n(e,i),u=s.code,a=s.msg;void 0===u||0===u?(this.logger.info(o+" suc"),t&&t({errorCode:0,extendedData:""})):(this.logger.info(o+" fail "+u+" "+a),r&&r({errorCode:this.stateCenter.getServerError(U+(u+1e9)).code,extendedData:a}))},mixFailFun:function(e,t,r,n,o,i){var s="";if(r)return r.code==u.TIMEOUT.code&&(r=O.error.S),r.code&&20010===r.code&&(r=JSON.parse(JSON.stringify(u.MIXER_NO_SERVICES))),void(n&&n(r,s));r=O.error.S;var a="";if((0,C.QP)(t))a=t;else{var d=o(t);a=d.code+" "+d.msg}s="request media server fail, error: "+e+" "+a,this.logger.error("".concat(i," http fail ").concat(s)),n&&n(r,s)},getStopMixStreamParams:function(e,t,r){var n={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"3.8.0"},o={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if((0,C.QP)(e)&&(n.task_id=e,o.task_id=e),null!=t){var i=void 0;n.stream_id=i=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+t:t,o.is_url=0,o.target=i}else null!=r&&(n.mixurl=r,o.is_url=1,o.target=r);return{req_body:n,mixStopReq:o}},getMixStreamStatus:function(e){this.logger.info("zb.sh.fmss call");for(var t=0;t<e.length;t++){var r=e[t],n=r.trans_type.replace("mixpushstatus:",""),o=n.replace(this.stateCenter.appid+":",""),i=this.mixStreamTaskList[o],s=JSON.parse(r.trans_data),u=s.request_id;if(i&&i.requestId===u){var a=parseInt(s.version);a<=i.mixStatusVer&&1!=a?this.logger.info("zb.sh.fmss data ver is not new"):this.fetchMixStreamStatus(n)}else this.logger.info("zb.sh.fmss taskId don't exist"),this.mixRequestIdList.push(u)}},fetchMixStreamStatus:function(e){var t=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new I);var r={request_seq:this.stateCenter.getSeq(),task_id:e},n=this.mixStreamProtoBuf.encodeGetMixStreamStatusReq(r),o=e.replace(this.stateCenter.appid+":","");this.sendMixRequest({interfaceID:13},n,(function(e,r){var n=function(e){try{var r=t.mixStreamProtoBuf.decodeGetMixStreamStatusRsp(e);(0,N.M$)(r),t.logger.info("zb.sh.fmss rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,push_url:r.push_url,request_seq:r.request_seq,task_id:r.task_id,version:r.version}}catch(e){return{code:-1}}}(e),i=n.code,s=n.msg,u=n.push_url,a=n.task_id,d=n.version;if(void 0!==i&&0!==i||!(0,C.Cs)(d))t.logger.warn("zb.sh.fmss fail "+i+" "+s);else{var m=t.mixStreamTaskList[o];if(!m)return void t.logger.info("zb.sh.fmss taskId don't exist");if(d<=m.mixStatusVer&&1!=d)return void t.logger.warn("zb.sh.fmss data ver is not new");m.mixStatusVer=d;var c=[];u.forEach((function(e){c.push({url:e.url,state:P[e.status],updateReason:X[e.reason],stateTime:E.isLong(e.mod_time)?e.mod_time.toNumber():e.mod_time})})),t.stateCenter.actionListener("mixerRelayCDNStateUpdate",a,c)}}),(function(e,r,n){t.logger.warn("zb.sh.fmss http fail "+e+" "+JSON.stringify(n))}))},startMixHb:function(e){var t=this;this.logger.info("zb.sh.smh.0 call");var r={request_seq:this.stateCenter.getSeq(),task_id:"".concat(e)},n=this.mixStreamProtoBuf.encodeMixStreamTaskHbReq(r);this.sendMixRequest({interfaceID:12},n,(function(r,n){var o=function(e){try{var r=t.mixStreamProtoBuf.decodeMixStreamTaskHbRsp(e);(0,N.M$)(r),t.logger.info("zb.sh.smh.0 rsp "+JSON.stringify(r));var n=r.common_response;return{code:n.code,msg:n.message,status:r.status,hb_interval:r.hb_interval}}catch(e){return{code:-1}}}(r),i=o.code,s=o.msg,u=o.status,a=o.hb_interval;void 0===i||0===i?(t.logger.info("zb.sh.smh.0 suc ".concat(u," ").concat(a)),(0,C.Cs)(a)&&0===u&&(!t.mixStreamHbList[e]&&(t.mixStreamHbList[e]={}),t.mixStreamHbList[e].timer=setTimeout((function(){t.startMixHb(e)}),1e3*a))):t.logger.info("zb.sh.smh.0 fail ".concat(i," ").concat(s))}),(function(e,r,n){t.logger.info("zb.sh.smh.0 send err ".concat(e," ").concat(n))}))}},B={type:"MixStream",install:function(e,t){for(var r in J)Object.defineProperty(e.prototype,r,{value:J[r],writable:!1});for(var r in W)Object.defineProperty(t.prototype,r,{value:W[r],writable:!1})}};return i}()}));